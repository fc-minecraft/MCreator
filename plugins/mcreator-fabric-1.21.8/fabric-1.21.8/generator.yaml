name: Fabric for @minecraft (@buildfileversion)
status: stable
buildfileversion: 0.133.4
subversion: 10

import:
  - datapack-1.21.8
  - neoforge-1.21.8:
    exclude:
      - procedures
      - triggers

# gradle task definitions
gradle:
  sync_task: eclipse
  run_client: runClient
  run_server: runServer
  export_file: "build/libs/modid-1.0.jar"

import_formatter:
  duplicates_whitelist:
    - java.util
    - net.minecraft
    - net.fabricmc
  priority_imports:
    Environment: net.fabricmc.api
    FabricLoader: net.fabricmc.loader.api
    Nullable: javax.annotation
    Codec: com.mojang.serialization
    SoundEvent: net.minecraft.sounds
    Blocks: net.minecraft.world.level.block
    Items: net.minecraft.world.item
    Multimap: com.google.common.collect
    ImmutableSet: com.google.common.collect
    Iterables: com.google.common.collect
    Attributes: net.minecraft.world.entity.ai.attributes
    Keyframe: net.minecraft.client.animation
    Potion: net.minecraft.world.item.alchemy
    MapColor: net.minecraft.world.level.material

# base generator roots
source_root: "@WORKSPACEROOT/src/main/java"
res_root: "@WORKSPACEROOT/src/main/resources"
mod_assets_root: "@RESROOT/assets/@modid"
mod_data_root: "@RESROOT/data/@modid"

# specific resource folders
sounds_dir: "@MODASSETSROOT/sounds"
structures_dir: "@MODDATAROOT/structure"
block_textures_dir: "@MODASSETSROOT/textures/block"
item_textures_dir: "@MODASSETSROOT/textures/item"
entity_textures_dir: "@MODASSETSROOT/textures/entities"
effect_textures_dir: "@MODASSETSROOT/textures/mob_effect"
particle_textures_dir: "@MODASSETSROOT/textures/particle"
screen_textures_dir: "@MODASSETSROOT/textures/screens"
armor_textures_dir: "@MODASSETSROOT/textures/models/armor"
other_textures_dir: "@MODASSETSROOT/textures"

# vanilla resources
vanilla_resources_jar: ".*-merged-.*.jar"
vanilla_block_textures_dir: "assets/minecraft/textures/block"
vanilla_item_textures_dir: "assets/minecraft/textures/item"

base_templates:
  - template: modbase/mod.java.ftl
    name: "@SRCROOT/@BASEPACKAGEPATH/@JavaModName.java"
  - template: modbase/mod_client.java.ftl
    name: "@SRCROOT/@BASEPACKAGEPATH/@JavaModNameClient.java"
  - template: modbase/fabric.mod.json.ftl
    writer: json
    name: "@RESROOT/fabric.mod.json"
  - template: pack.mcmeta.ftl # loaded from datapack generator
    writer: json
    name: "@RESROOT/pack.mcmeta"
  - template: modbase/sounds.json.ftl
    writer: json
    name: "@MODASSETSROOT/sounds.json"
    condition: hasSounds()
  - template: modbase/sounds.java.ftl
    name: "@SRCROOT/@BASEPACKAGEPATH/init/@JavaModNameSounds.java"
    condition: hasSounds()
  - template: modbase/variableslist.java.ftl
    name: "@SRCROOT/@BASEPACKAGEPATH/network/@JavaModNameVariables.java"
    condition: hasVariables()
  - template: elementinits/tabs.java.ftl
    name: "@SRCROOT/@BASEPACKAGEPATH/init/@JavaModNameTabs.java"
    condition: hasItemsInTabs()
  - template: modbase/accesswidener.ftl
    usercodeComment: "#"
    writer: file
    name: "@RESROOT/META-INF/@modid.accesswidener"
  - template: elementinits/javamodels.java.ftl
    name: "@SRCROOT/@BASEPACKAGEPATH/init/@JavaModNameModels.java"
    condition: hasJavaModels()
  - template: modbase/mixin.json.ftl
    writer: json
    name: "@RESROOT/@modid.mixins.json"
  - template: elementinits/features.java.ftl
    writer: java
    condition_any:
      - "${w.getGElementsOfType('block')?filter(e -> e.generateFeature)?size != 0}"
      - "${w.getGElementsOfType('plant')?filter(e -> e.generateFeature)?size != 0}"
      - "${w.hasElementsOfType('feature')}"
    name: "@SRCROOT/@BASEPACKAGEPATH/init/@JavaModNameFeatures.java"

# Mixins
  - template: mixin/livingentity_mixin.java.ftl
    writer: java
    name: "@SRCROOT/@BASEPACKAGEPATH/mixin/LivingEntityMixin.java"
  - template: mixin/player_mixin.java.ftl
    writer: java
    name: "@SRCROOT/@BASEPACKAGEPATH/mixin/PlayerMixin.java"
  - template: mixin/itemstack_mixin.java.ftl
    writer: java
    name: "@SRCROOT/@BASEPACKAGEPATH/mixin/ItemStackMixin.java"
  - template: mixin/blockitem_mixin.java.ftl
    writer: java
    name: "@SRCROOT/@BASEPACKAGEPATH/mixin/BlockItemMixin.java"
  - template: mixin/bonemealitem_mixin.java.ftl
    writer: java
    name: "@SRCROOT/@BASEPACKAGEPATH/mixin/BoneMealItemMixin.java"
  - template: mixin/commands_mixin.java.ftl
    writer: java
    name: "@SRCROOT/@BASEPACKAGEPATH/mixin/CommandsMixin.java"
  - template: mixin/experienceorb_mixin.java.ftl
    writer: java
    name: "@SRCROOT/@BASEPACKAGEPATH/mixin/ExperienceOrbMixin.java"

# Custom events
  - template: event/livingentity_events.java.ftl
    writer: java
    name: "@SRCROOT/@BASEPACKAGEPATH/event/LivingEntityEvents.java"
  - template: event/player_events.java.ftl
    writer: java
    name: "@SRCROOT/@BASEPACKAGEPATH/event/PlayerEvents.java"
  - template: event/block_events.java.ftl
    writer: java
    name: "@SRCROOT/@BASEPACKAGEPATH/event/BlockEvents.java"
  - template: event/item_events.java.ftl
    writer: java
    name: "@SRCROOT/@BASEPACKAGEPATH/event/ItemEvents.java"
  - template: event/misc_events.java.ftl
    writer: java
    name: "@SRCROOT/@BASEPACKAGEPATH/event/MiscEvents.java"


java_models:
  key: mojmap-1.21.x
  compatible: [mojmap-1.17.x, mojmap-1.18.x, mojmap-1.19.x, mojmap-1.20.x]
  requested_key_words: [ModelPart, ~ModelRenderer]

sources_setup_tasks:
  - task: copy_models
    type: JAVA_viatemplate
    cleanupBeforeCopy: true
    template: javamodel.java.ftl
    to: "@SRCROOT/@BASEPACKAGEPATH/client/model"
  - task: copy_model_animations
    type: JAVA_viatemplate
    cleanupBeforeCopy: true
    template: javaanimation.java.ftl
    to: "@SRCROOT/@BASEPACKAGEPATH/client/model/animations"

tags:
  template: tags.json.ftl # loaded from datapack generator
  name: "@RESROOT/data/@namespace/tags/@folder/@name.json"

language_file:
  format: json
  root_folder: "@MODASSETSROOT/lang/"
  langfile_name: "@langname.json"

resources_setup_tasks:
  - task: copy_file
    from: "@MODASSETSROOT/textures/@modpicture.png"
    to: "@RESROOT/logo.png"
  - task: copy_models
    type: OBJ_referencetextures
    to: "@MODASSETSROOT/models/item"
  - task: copy_models
    type: JSON_noinlinetextures
    to: "@MODASSETSROOT/models/custom"